# 生长曲线图表 UI 优化说明

## ✨ 新 UI 特性

### 1. 区域填充显示
参考专业儿保应用（如宝宝树、育学园等），使用**绿色半透明区域**填充 P3-P97 正常范围，让用户一目了然地看到正常区间。

- **P3-P97 区域**：浅绿色填充（rgba(52, 199, 89, 0.15)）
- **P3 和 P97 边界线**：绿色虚线标注
- **P50 中位数**：蓝色实线（#007AFF）
- **宝宝数据**：红色粗线（#FF3B30）

### 2. 时间范围选择
提供三个时间维度供用户切换：
- **半年**：显示 0-6 个月数据
- **1年**：显示 0-12 个月数据（默认）
- **3年**：显示 0-36 个月数据

### 3. 标准选择器
显示当前使用的评估标准：
```
🛡️ WS/T 423-2022 儿童生长标准（0-7岁）
```

### 4. 当前值卡片
在图表左上角浮动显示当前最新数据：
- 测量值（如：9.5 kg）
- 百分位（如：P65）
- 测量日期（如：12/28）

### 5. 清晰的百分位标注
在图表右侧标注主要百分位：
- **97%**：绿色
- **50%**：蓝色（中位数）
- **3%**：绿色

### 6. "今天"标记
最新数据点用双层圆圈+文字"今天"标注，便于识别。

### 7. 图例说明
底部提供清晰的图例：
- □ P3-P97 正常范围（半透明方块）
- ● P50 中位数（蓝色圆点）
- ● 宝宝数据（红色圆点）

### 8. 参考来源
明确标注数据来源和权威性：
```
参考来源：
依据国家卫健委 WS/T 423-2022《7岁以下儿童生长标准》
的婴幼儿营养状况评价指标
```

### 9. 帮助按钮
点击"了解生长曲线与百分位"按钮，弹出详细说明：
- 百分位的含义
- 正常范围解释
- 何时需要关注

## 📊 技术实现

### 使用 react-native-svg 绘制
```typescript
// 核心绘图元素：
- Polygon: 绘制 P3-P97 填充区域
- Line: 绘制百分位曲线和连线
- Circle: 绘制宝宝数据点
- SvgText: 绘制轴标签和百分位标注
```

### 坐标系统
```typescript
// X 轴：月龄（0 - maxAge）
// Y 轴：测量值（动态范围，基于数据自适应）

const xToScreen = (x: number) => {
  return paddingLeft + (x / maxAge) * plotWidth;
};

const yToScreen = (y: number) => {
  return paddingTop + plotHeight - ((y - minY) / (maxY - minY)) * plotHeight;
};
```

### 动态数据过滤
根据选择的时间范围，自动过滤显示的数据点和标准曲线。

## 🎨 设计细节

### 颜色方案
- **正常范围填充**：`rgba(52, 199, 89, 0.15)` - 浅绿色，传达健康
- **边界线**：`rgba(52, 199, 89, 0.5)` - 半透明绿色虚线
- **中位数线**：`#007AFF` - iOS 蓝色，表示标准
- **宝宝数据**：`#FF3B30` - 红色，醒目突出
- **警告色**：`#FF9500` - 橙色，用于异常值

### 尺寸规格
- 图表宽度：屏幕宽度 - 32px
- 图表高度：320px
- 左边距：50px（用于 Y 轴标签）
- 右边距：30px（用于百分位标注）
- 上下边距：20px / 50px

### 交互反馈
- 时间范围按钮：点击切换，激活状态显示蓝色背景
- 标准选择器：显示下拉箭头（预留未来扩展 WHO 标准）
- 帮助按钮：点击显示 Alert 说明

## 📱 用户体验优化

### 1. 直观性
- ✅ 绿色区域一眼识别正常范围
- ✅ 红线清晰显示宝宝生长轨迹
- ✅ 百分位标注便于快速评估

### 2. 专业性
- ✅ 标注权威标准来源
- ✅ 提供详细百分位说明
- ✅ 使用医学专业术语

### 3. 易用性
- ✅ 一键切换时间范围
- ✅ 自动计算和标注
- ✅ 空状态友好提示

### 4. 信息密度
- ✅ 在有限空间内展示完整信息
- ✅ 层次分明，重点突出
- ✅ 避免信息过载

## 🔄 与其他组件配合

### GrowthScreen 集成
```typescript
<GrowthChart
  baby={currentBaby}
  records={records}
  metric={typeInfo.metric}
/>
```

### AssessmentCard 配合
图表下方显示详细的文字评估，两者相辅相成：
- 图表：视觉化展示趋势
- 评估卡：具体数值和建议

## 🎯 与参考设计的对比

### 参考设计（您提供的截图）
✅ 区域填充显示正常范围
✅ 时间范围选择（半年/1年/3年）
✅ 标准选择器
✅ 清晰的百分位标注
✅ 参考来源说明

### 我们的增强
➕ 更醒目的"今天"标记
➕ 浮动当前值卡片
➕ 详细的帮助说明按钮
➕ 响应式布局适配不同屏幕
➕ 平滑的数据连线

## 🚀 未来扩展

### 计划中的功能
1. **标准切换**：WHO 2006 标准对照
2. **数据点交互**：点击查看详细信息
3. **导出图表**：分享给医生
4. **生长速度曲线**：评估增长速率
5. **多宝宝对比**：兄弟姐妹数据对比

### 性能优化
- 使用 `useMemo` 缓存计算结果
- SVG 渲染优化
- 数据点限制（避免过多点影响性能）

## 💡 使用建议

### 医学声明
所有图表和评估结果仅供参考，不能替代专业医疗诊断。如有异常情况，请及时咨询儿科医生或儿保专家。

### 数据准确性
- 定期测量（建议每月一次）
- 保持测量条件一致
- 使用校准过的测量工具
- 记录测量时间和状态



