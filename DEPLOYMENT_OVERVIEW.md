# BabyBeats 完整部署流程总览

> 本文档提供从开发到生产的完整部署路线图

## 📋 目录

1. [部署流程概览](#部署流程概览)
2. [时间线规划](#时间线规划)
3. [成本估算](#成本估算)
4. [快速开始](#快速开始)
5. [详细指南索引](#详细指南索引)

---

## 部署流程概览

```
┌─────────────────────────────────────────────────────────────────┐
│                         准备阶段（1-2周）                         │
├─────────────────────────────────────────────────────────────────┤
│ 1. 申请 Apple 开发者账号 ($99/年)                                │
│ 2. 购买服务器和域名 (¥200-400/月 + ¥55/年)                      │
│ 3. 注册 Expo 账号（免费）                                        │
│ 4. 准备应用资料（图标、截图、描述等）                             │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                      后端部署阶段（1-2天）                        │
├─────────────────────────────────────────────────────────────────┤
│ 1. 服务器初始化和安全配置                                         │
│ 2. 使用 Docker 部署后端 API                                      │
│ 3. 配置 PostgreSQL 数据库                                        │
│ 4. 配置域名和 SSL 证书（HTTPS）                                  │
│ 5. 设置自动备份和监控                                            │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                    iOS 配置阶段（2-3天）                          │
├─────────────────────────────────────────────────────────────────┤
│ 1. 配置 App Store Connect                                       │
│ 2. 创建应用记录                                                  │
│ 3. 配置 EAS Build                                               │
│ 4. 连接 Apple Developer 账号                                    │
│ 5. 更新前端 API 地址为生产环境                                   │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                   TestFlight 内测阶段（2-4周）                   │
├─────────────────────────────────────────────────────────────────┤
│ 1. 使用 EAS Build 构建 iOS 应用                                 │
│ 2. 提交到 TestFlight                                            │
│ 3. 配置测试群组                                                  │
│ 4. 生成邀请码/链接                                               │
│ 5. 邀请测试用户（内部 + 外部）                                   │
│ 6. 收集反馈和修复 Bug                                            │
│ 7. 发布测试版本更新                                              │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                  App Store 审核阶段（3-5天）                     │
├─────────────────────────────────────────────────────────────────┤
│ 1. 准备发布资料（截图、描述、隐私政策等）                         │
│ 2. 填写 App Store 商品信息                                      │
│ 3. 提交审核                                                      │
│ 4. 等待审核（平均 2-4 天）                                       │
│ 5. 如被拒，修改后重新提交                                        │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        正式发布🎉                                │
├─────────────────────────────────────────────────────────────────┤
│ 1. 审核通过后选择发布时间                                         │
│ 2. 应用上架 App Store（24小时内全球可见）                        │
│ 3. 监控用户反馈和崩溃报告                                         │
│ 4. 准备后续版本更新                                              │
└─────────────────────────────────────────────────────────────────┘
```

---

## 时间线规划

### 完整发布时间线：5-8 周

| 阶段 | 任务 | 预计时间 | 说明 |
|------|------|---------|------|
| **Week 1** | 账号申请 | 2-7 天 | 个人账号快，公司账号慢 |
| | 服务器购买 | 1 天 | 即时开通 |
| | 后端部署 | 1-2 天 | Docker 部署较快 |
| **Week 2** | iOS 配置 | 2-3 天 | 包括 EAS 配置 |
| | 首次构建 | 1-2 小时 | 自动化流程 |
| | TestFlight 上传 | 30 分钟 | 等待处理 |
| **Week 3-5** | 内部测试 | 1 周 | 团队内部 |
| | 外部测试准备 | 1-2 天 | 需 Apple 审核 |
| | 外部测试 | 2-3 周 | 收集反馈 |
| | Bug 修复 | 持续 | 根据反馈 |
| **Week 6** | 准备发布资料 | 2-3 天 | 截图、文案等 |
| | 提交审核 | 1 天 | 填写信息 |
| **Week 7** | 等待审核 | 2-4 天 | Apple 审核 |
| | 审核通过 | - | 可能需要多次 |
| **Week 8** | 正式发布 | 1 天 | 上架 App Store |

### 快速通道：3-4 周

如果跳过长时间外部测试，可以压缩到 3-4 周：
- Week 1: 准备 + 部署
- Week 2: 配置 + 内部测试
- Week 3: 提交审核
- Week 4: 发布

---

## 成本估算

### 一次性费用

| 项目 | 费用 | 说明 |
|------|------|------|
| **Apple 开发者账号** | $99/年 (约 ¥700) | 必需 |
| **域名注册** | ¥55-100/年 | .com 域名 |
| **SSL 证书** | 免费 | Let's Encrypt |
| **Expo EAS Build** | 免费 | 每月 30 次构建 |

**小计：约 ¥750-800/年**

### 月度费用（服务器）

#### 初创阶段（0-1000 用户）

| 方案 | CPU/内存 | 带宽 | 月费用 |
|------|---------|------|--------|
| **阿里云 ECS** | 2核4G | 5M | ¥200-300 |
| **腾讯云 CVM** | 2核4G | 5M | ¥180-250 |
| **DigitalOcean** | 2GB/1CPU | 2TB | $18 (¥130) |
| **AWS EC2** | t3.medium | - | $30 (¥220) |

**推荐：**
- 国内用户：阿里云/腾讯云（新用户有优惠）
- 国际用户：DigitalOcean

#### 成长阶段（1000-10000 用户）

| 配置 | 月费用 |
|------|--------|
| 应用服务器 4核8G | ¥400-600 |
| 数据库备份 | ¥50-100 |
| CDN 流量 | ¥100-300 |
| **总计** | ¥550-1000/月 |

### 总成本估算（第一年）

```
准备期：
  - Apple 开发者账号: ¥700
  - 域名: ¥55
  ───────────────────
  小计: ¥755

运营期（按 12 个月）：
  - 服务器: ¥200/月 × 12 = ¥2,400
  - 可选升级费用: ¥0-500/月
  ───────────────────
  小计: ¥2,400-8,400

第一年总计: ¥3,155 - 9,155
平均每月: ¥260 - 760
```

### 节省成本建议

1. **使用新用户优惠**
   - 阿里云新用户首购：3个月约 ¥300（2核4G）
   - 腾讯云新用户：首年 ¥99-299
   - DigitalOcean：使用推广链接获得 $200 额度

2. **选择包年付费**
   - 通常有 8-9 折优惠
   - 节省约 10-20%

3. **优化资源使用**
   - 初期使用单服务器
   - 使用 Docker 提高资源利用率
   - 按需扩容

---

## 快速开始

### 方案 A: 最快路径（推荐初次发布）

适合：想快速上线，有一定预算

```bash
# 1. 购买服务
- Apple 开发者账号（个人）: 1-2天
- 阿里云服务器（按量付费）: 即时
- 域名（阿里云）: 即时

# 2. 部署后端（1天）
cd BabyBeats/backend
# 按照 BACKEND_DEPLOYMENT_GUIDE.md 操作
docker compose up -d

# 3. 配置 iOS（1天）
cd ../baby-beats-app
# 按照 IOS_DEPLOYMENT_GUIDE.md 操作
eas build --platform ios --profile production

# 4. 测试（1周）
# TestFlight 内部测试

# 5. 提交审核（3-5天）
# 等待 Apple 审核

总时间: 约 2-3 周
```

### 方案 B: 稳妥路径（推荐商业应用）

适合：追求质量，充分测试

```bash
# 1-2周: 准备工作
- 申请账号
- 购买服务
- 后端部署

# 2-4周: 充分测试
- 内部测试（1周）
- 外部测试（2-3周）
- 修复问题

# 1周: 准备发布资料
- 专业截图
- 优化描述
- 准备营销素材

# 1周: 提交和审核

总时间: 约 5-7 周
```

---

## 详细指南索引

### 📱 iOS 发布

**文档**: [IOS_DEPLOYMENT_GUIDE.md](./IOS_DEPLOYMENT_GUIDE.md)

**包含内容**:
1. Apple 开发者账号申请详细流程
2. Expo EAS 配置和使用
3. TestFlight 内测完整指南
   - 内部测试配置
   - 外部测试配置
   - 邀请码生成和分发
4. App Store 审核准备
5. 正式发布流程
6. 版本更新指南

### 🖥️ 后端部署

**文档**: [BACKEND_DEPLOYMENT_GUIDE.md](./BACKEND_DEPLOYMENT_GUIDE.md)

**包含内容**:
1. 服务器选购详细对比
   - 国内/国际服务商
   - 配置推荐
   - 购买流程
2. 服务器初始化和安全配置
3. Docker 部署方式（推荐）
4. 传统部署方式
5. 数据库管理和备份
6. 域名和 SSL 证书配置
7. 监控、日志和告警
8. 性能优化建议

---

## 分步操作清单

### Phase 1: 准备工作 ✓

- [ ] 注册 Apple 开发者账号
  - [ ] 准备 Apple ID
  - [ ] 访问 developer.apple.com
  - [ ] 完成注册并支付 $99
  - [ ] 等待审核通过（1-7天）

- [ ] 购买服务器
  - [ ] 选择服务商（推荐阿里云）
  - [ ] 选择配置（推荐 2核4G）
  - [ ] 选择地域（华东或华北）
  - [ ] 配置安全组（开放 22/80/443）
  - [ ] 记录服务器 IP

- [ ] 购买域名
  - [ ] 选择域名（如 babybeats.com）
  - [ ] 完成购买
  - [ ] 配置 DNS 解析到服务器 IP

- [ ] 注册 Expo 账号
  - [ ] 访问 expo.dev
  - [ ] 注册账号（免费）
  - [ ] 安装 EAS CLI: `npm install -g eas-cli`
  - [ ] 登录: `eas login`

### Phase 2: 后端部署 ✓

- [ ] 连接服务器
  ```bash
  ssh root@YOUR_SERVER_IP
  ```

- [ ] 初始化配置
  - [ ] 更新系统: `apt update && apt upgrade -y`
  - [ ] 创建新用户
  - [ ] 配置 SSH 密钥
  - [ ] 配置防火墙

- [ ] 安装依赖
  - [ ] 安装 Docker
  - [ ] 安装 Docker Compose
  - [ ] 安装 Git, Nginx

- [ ] 部署应用
  ```bash
  git clone https://github.com/yourusername/BabyBeats.git
  cd BabyBeats/backend
  cp .env.example .env
  nano .env  # 配置环境变量
  docker compose up -d --build
  ```

- [ ] 配置 Nginx 和 SSL
  ```bash
  sudo nano /etc/nginx/sites-available/babybeats
  sudo ln -s /etc/nginx/sites-available/babybeats /etc/nginx/sites-enabled/
  sudo certbot --nginx -d yourdomain.com
  ```

- [ ] 验证部署
  ```bash
  curl https://yourdomain.com/api/v1/health
  ```

### Phase 3: iOS 配置 ✓

- [ ] 配置 App Store Connect
  - [ ] 登录 appstoreconnect.apple.com
  - [ ] 创建新 App
  - [ ] 填写基本信息
  - [ ] 配置 Bundle ID: `com.babybeats.app`

- [ ] 配置 EAS
  ```bash
  cd baby-beats-app
  eas build:configure
  ```

- [ ] 更新配置文件
  - [ ] 编辑 `app.json`：更新版本号、配置信息
  - [ ] 编辑 `eas.json`：配置构建选项
  - [ ] 更新 API 地址为生产环境

- [ ] 首次构建
  ```bash
  eas build --platform ios --profile production
  ```

### Phase 4: TestFlight 测试 ✓

- [ ] 配置 TestFlight
  - [ ] 等待构建完成并上传（30分钟）
  - [ ] 在 App Store Connect → TestFlight 查看
  - [ ] 创建内部测试组
  - [ ] 添加内部测试人员

- [ ] 内部测试（1周）
  - [ ] 分发应用给团队
  - [ ] 收集测试反馈
  - [ ] 修复关键 Bug
  - [ ] 发布测试更新

- [ ] 外部测试配置
  - [ ] 创建外部测试组
  - [ ] 启用公开链接
  - [ ] 提交外部测试审核（需1-2天）

- [ ] 外部测试（2-3周）
  - [ ] 分享邀请链接
  - [ ] 收集用户反馈
  - [ ] 监控崩溃报告
  - [ ] 持续优化应用

### Phase 5: App Store 发布 ✓

- [ ] 准备发布资料
  - [ ] 应用截图（5-8张）
    - 6.7" Display: 1290 x 2796 px
    - 6.5" Display: 1284 x 2778 px
    - 5.5" Display: 1242 x 2208 px
  - [ ] App 图标: 1024x1024 px
  - [ ] App 预览视频（可选）
  - [ ] 应用描述和关键词
  - [ ] 隐私政策 URL
  - [ ] 支持 URL

- [ ] 填写 App Store 信息
  - [ ] App 名称和副标题
  - [ ] 类别选择
  - [ ] 定价（免费）
  - [ ] App 隐私信息
  - [ ] 年龄分级
  - [ ] 版本说明

- [ ] 提交审核
  - [ ] 选择构建版本
  - [ ] 填写审核信息
  - [ ] 提供测试账号
  - [ ] 提交审核

- [ ] 等待审核（2-4天）
  - [ ] 关注审核状态
  - [ ] 及时回复 Resolution Center
  - [ ] 如被拒，修改后重新提交

- [ ] 发布上线
  - [ ] 审核通过后选择发布
  - [ ] 监控用户反馈
  - [ ] 准备运营推广

---

## 常见问题速查

### Q1: 最快多久可以发布？
**A**: 理想情况下 2-3 周：
- Apple 账号审核：1-2天
- 后端部署：1天
- iOS 配置和构建：1天
- TestFlight 内部测试：3-5天
- App Store 审核：2-4天

### Q2: 最便宜需要多少钱？
**A**: 第一年约 ¥3,155：
- Apple 开发者账号：¥700/年
- 域名：¥55/年
- 服务器：¥200/月 × 12 = ¥2,400

使用新用户优惠可以节省 30-50%。

### Q3: 需要什么技术背景？
**A**: 
- 基本的命令行操作
- 了解 Git 基础
- 能看懂配置文件
- 按照文档一步步操作即可

### Q4: 审核被拒怎么办？
**A**: 
1. 仔细阅读拒绝原因
2. 在 Resolution Center 与审核团队沟通
3. 修复问题后重新提交
4. 通常 2-3 次能通过

### Q5: 可以先发布 Android 吗？
**A**: 可以，Android 发布相对简单：
- Google Play 开发者账号：$25（一次性）
- 审核时间：1-3 天
- 无需 Mac 电脑

但 iOS 用户付费意愿更高，建议优先 iOS。

### Q6: 需要购买 Mac 吗？
**A**: 不需要！使用 Expo EAS Build：
- 云端构建，无需本地 Xcode
- 支持 Windows/Linux/Mac
- 全自动化流程

### Q7: 服务器配置够用吗？
**A**: 2核4G 配置支持：
- 0-1000 并发用户
- 每秒 50-100 请求
- 可随时升级

---

## 下一步行动

### 立即开始

1. **今天**: 注册 Apple 开发者账号
2. **明天**: 购买服务器和域名
3. **第3天**: 部署后端服务
4. **第4-5天**: 配置 iOS 和首次构建
5. **第1-2周**: TestFlight 测试
6. **第3周**: 提交 App Store 审核
7. **第4周**: 🎉 正式发布！

### 获取帮助

- **iOS 发布问题**: 查看 [IOS_DEPLOYMENT_GUIDE.md](./IOS_DEPLOYMENT_GUIDE.md)
- **后端部署问题**: 查看 [BACKEND_DEPLOYMENT_GUIDE.md](./BACKEND_DEPLOYMENT_GUIDE.md)
- **技术文档**: 查看项目 README.md
- **快速启动**: 查看 STARTUP_GUIDE.md

### 推荐阅读顺序

```
1. 本文档 (DEPLOYMENT_OVERVIEW.md) - 了解全局
   ↓
2. BACKEND_DEPLOYMENT_GUIDE.md - 部署后端
   ↓
3. IOS_DEPLOYMENT_GUIDE.md - 发布 iOS
   ↓
4. 开始测试和迭代
```

---

## 成功案例参考

典型的独立开发者发布时间线：

```
第1天（周一）: 
  ✓ 注册 Apple 开发者账号
  ✓ 购买阿里云服务器（2核4G）
  ✓ 购买域名 babybeats.com

第2-3天（周二-周三）:
  ✓ 部署后端到服务器
  ✓ 配置域名和 SSL
  ✓ 测试 API 接口

第4-5天（周四-周五）:
  ✓ 配置 App Store Connect
  ✓ 首次 EAS 构建
  ✓ 上传到 TestFlight

第2周:
  ✓ 内部团队测试
  ✓ 修复 5 个关键 Bug
  ✓ 发布 TestFlight 更新

第3周:
  ✓ 外部测试（50 人）
  ✓ 准备发布资料
  ✓ 提交 App Store 审核

第4周（周三）:
  ✓ 审核通过（用时 3 天）
  🎉 正式发布上线！

总耗时: 23 天
总成本: ¥1,200（使用新用户优惠）
```

---

**祝您发布顺利！如有问题，欢迎查阅详细指南或提交 Issue。** 🚀

---

*最后更新: 2025-11-17*
*版本: 1.0.0*

