# BabyBeats 部署检查清单

> 使用本清单确保完整和正确的部署流程

## 📋 使用说明

- ✅ 已完成
- ⏳ 进行中
- ❌ 未开始
- ⚠️ 需要注意

在每个步骤前标记状态，确保不遗漏任何环节。

---

## Phase 1: 准备阶段

### 账号和域名申请

- [ ] **Apple 开发者账号**
  - [ ] 准备 Apple ID（建议使用公司邮箱）
  - [ ] 访问 https://developer.apple.com
  - [ ] 选择账号类型（个人/公司）
  - [ ] 完成支付 $99
  - [ ] 启用双重认证（2FA）
  - [ ] 等待审核通过（个人 1-2 天，公司 1-2 周）
  - [ ] 记录 Team ID: `___________________`
  
- [ ] **Expo 账号**
  - [ ] 访问 https://expo.dev
  - [ ] 注册账号（免费）
  - [ ] 安装 EAS CLI: `npm install -g eas-cli`
  - [ ] 登录: `eas login`
  - [ ] 记录账号: `___________________`

- [ ] **服务器购买**
  - [ ] 选择服务商: □ 阿里云 □ 腾讯云 □ DigitalOcean □ 其他
  - [ ] 选择配置: CPU __核 / 内存 __GB / 存储 __GB
  - [ ] 选择地域: `___________________`
  - [ ] 配置安全组（开放端口 22, 80, 443）
  - [ ] 记录服务器信息:
    - IP 地址: `___________________`
    - 用户名: `___________________`
    - 密码/密钥路径: `___________________`

- [ ] **域名购买**
  - [ ] 选择域名: `___________________`
  - [ ] 完成购买
  - [ ] 域名注册商: □ 阿里云 □ 腾讯云 □ Namecheap □ 其他
  - [ ] 记录管理后台: `___________________`

### 准备资料

- [ ] **应用资料**
  - [ ] 应用名称（中英文）: `___________________`
  - [ ] 应用图标 (1024x1024 PNG): `___________________`
  - [ ] 应用描述（中英文，最多 4000 字符）
  - [ ] 应用关键词（最多 100 字符）
  - [ ] 应用分类: 主类别 `___________` 次类别 `___________`
  
- [ ] **应用截图**（每种尺寸至少 1 张）
  - [ ] 6.7" Display (1290 x 2796): ____ 张
  - [ ] 6.5" Display (1284 x 2778): ____ 张
  - [ ] 5.5" Display (1242 x 2208): ____ 张
  - [ ] 准备内容：
    - [ ] 主界面/今日概览
    - [ ] 喂养记录界面
    - [ ] 睡眠记录界面
    - [ ] 成长曲线图表
    - [ ] 疫苗接种记录

- [ ] **App 预览视频**（可选）
  - [ ] 视频时长 15-30 秒
  - [ ] 格式: .mov, .mp4, .m4v
  - [ ] 视频路径: `___________________`

- [ ] **法律文档**
  - [ ] 隐私政策 URL: `___________________`
  - [ ] 服务条款 URL: `___________________`
  - [ ] 支持 URL: `___________________`
  - [ ] 营销 URL（可选）: `___________________`
  - [ ] 联系邮箱: `___________________`
  - [ ] 联系电话: `___________________`

---

## Phase 2: 后端部署

### 服务器初始化

- [ ] **连接服务器**
  ```bash
  ssh root@YOUR_SERVER_IP
  ```
  - [ ] 首次登录成功
  - [ ] 记录登录时间: `___________________`

- [ ] **运行初始化脚本**
  ```bash
  wget https://raw.githubusercontent.com/yourusername/BabyBeats/main/backend/setup-server.sh
  sudo bash setup-server.sh
  ```
  - [ ] 系统更新完成
  - [ ] Docker 安装完成
  - [ ] Nginx 安装完成
  - [ ] 防火墙配置完成
  - [ ] 用户 `babybeats` 创建完成

- [ ] **SSH 密钥配置**
  ```bash
  # 本地生成密钥（如果还没有）
  ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
  
  # 复制公钥到服务器
  ssh-copy-id babybeats@YOUR_SERVER_IP
  ```
  - [ ] 密钥生成完成
  - [ ] 公钥已复制
  - [ ] 测试密钥登录成功
  - [ ] 密钥路径: `___________________`

- [ ] **安全加固**（可选但推荐）
  - [ ] 修改 SSH 端口（从 22 改为其他）
  - [ ] 禁用 root 登录
  - [ ] 禁用密码登录（只允许密钥）
  - [ ] 配置 Fail2Ban

### 应用部署

- [ ] **克隆代码**
  ```bash
  su - babybeats
  cd ~
  git clone https://github.com/yourusername/BabyBeats.git
  cd BabyBeats/backend
  ```
  - [ ] 代码克隆完成
  - [ ] 项目路径: `___________________`

- [ ] **配置环境变量**
  ```bash
  cp .env.example .env
  nano .env
  ```
  - [ ] .env 文件已创建
  - [ ] 配置项填写完成：
    - [ ] NODE_ENV=production
    - [ ] DB_PASSWORD（强密码）
    - [ ] JWT_SECRET（至少 64 字符）
    - [ ] CORS_ORIGIN（你的域名）
    - [ ] 其他必需配置

  **生成强密码命令**：
  ```bash
  # JWT Secret
  openssl rand -base64 64
  
  # Database Password
  openssl rand -base64 32
  ```

- [ ] **启动服务**
  ```bash
  cd ~/BabyBeats/backend
  chmod +x deploy.sh
  ./deploy.sh production
  ```
  - [ ] Docker 镜像构建成功
  - [ ] 容器启动成功
  - [ ] 数据库初始化成功
  - [ ] API 健康检查通过

- [ ] **验证部署**
  ```bash
  curl http://localhost:3000/health
  docker compose ps
  docker compose logs
  ```
  - [ ] API 返回正常
  - [ ] 所有容器运行中
  - [ ] 无错误日志

### 域名和 SSL 配置

- [ ] **配置 DNS 解析**
  - [ ] A 记录: @ → YOUR_SERVER_IP
  - [ ] A 记录: www → YOUR_SERVER_IP
  - [ ] A 记录: api → YOUR_SERVER_IP
  - [ ] 等待 DNS 生效（10-30 分钟）
  - [ ] 验证: `ping yourdomain.com`

- [ ] **配置 Nginx**
  ```bash
  sudo nano /etc/nginx/sites-available/babybeats
  ```
  - [ ] 配置文件已创建
  - [ ] 配置反向代理到 localhost:3000
  - [ ] 启用配置: `sudo ln -s /etc/nginx/sites-available/babybeats /etc/nginx/sites-enabled/`
  - [ ] 测试配置: `sudo nginx -t`
  - [ ] 重启 Nginx: `sudo systemctl restart nginx`

- [ ] **申请 SSL 证书**
  ```bash
  sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com -d api.yourdomain.com
  ```
  - [ ] 输入邮箱地址
  - [ ] 同意服务条款
  - [ ] 选择重定向到 HTTPS
  - [ ] 证书申请成功
  - [ ] 自动续期已配置

- [ ] **验证 HTTPS**
  ```bash
  curl https://yourdomain.com/api/v1/health
  ```
  - [ ] HTTPS 访问正常
  - [ ] HTTP 自动重定向到 HTTPS
  - [ ] 证书有效（访问浏览器查看锁图标）

### 备份和监控

- [ ] **配置数据库备份**
  ```bash
  nano ~/backup-database.sh
  chmod +x ~/backup-database.sh
  ./backup-database.sh  # 测试
  ```
  - [ ] 备份脚本已创建
  - [ ] 测试备份成功
  - [ ] 备份文件位置: `___________________`

- [ ] **设置定时备份**
  ```bash
  crontab -e
  # 添加: 0 2 * * * /home/babybeats/backup-database.sh
  ```
  - [ ] Cron 任务已添加
  - [ ] 备份频率: 每天 ____ 点

- [ ] **配置监控**（可选）
  - [ ] 安装 Netdata
  - [ ] 配置邮件告警
  - [ ] 设置健康检查脚本
  - [ ] 监控面板 URL: `___________________`

---

## Phase 3: iOS 配置

### App Store Connect 配置

- [ ] **登录 App Store Connect**
  - [ ] 访问 https://appstoreconnect.apple.com
  - [ ] 使用 Apple 开发者账号登录

- [ ] **创建新 App**
  - [ ] 点击"我的 App" → "+"  → "新建 App"
  - [ ] 填写信息：
    - [ ] 平台: iOS
    - [ ] 名称: BabyBeats
    - [ ] 主要语言: 简体中文
    - [ ] 套装 ID: com.babybeats.app
    - [ ] SKU: babybeats-app-001
  - [ ] 记录 App ID: `___________________`

- [ ] **填写 App 信息**
  - [ ] App 名称
  - [ ] 副标题
  - [ ] 类别（主/次）
  - [ ] 内容版权
  - [ ] 年龄分级（完成问卷）
  - [ ] 隐私政策 URL
  - [ ] 定价（免费）
  - [ ] 销售范围

- [ ] **配置 App 隐私**
  - [ ] 数据收集类型
  - [ ] 数据使用说明
  - [ ] 第三方跟踪
  - [ ] 隐私声明

### EAS 配置

- [ ] **初始化 EAS**
  ```bash
  cd baby-beats-app
  eas build:configure
  ```
  - [ ] eas.json 已创建
  - [ ] 项目 ID 已生成

- [ ] **配置 app.json**
  - [ ] 更新 version: `___________________`
  - [ ] 更新 buildNumber: `___________________`
  - [ ] 配置 bundleIdentifier: com.babybeats.app
  - [ ] 配置权限说明（Camera, Photos, Reminders）
  - [ ] 更新 API URL 为生产环境: `___________________`

- [ ] **连接 Apple 账号**
  ```bash
  eas credentials
  ```
  - [ ] 登录 Apple Developer 账号
  - [ ] 选择 Team
  - [ ] 证书自动创建
  - [ ] Provisioning Profile 自动创建

### 首次构建

- [ ] **构建生产版本**
  ```bash
  chmod +x deploy-ios.sh
  ./deploy-ios.sh production
  ```
  或手动：
  ```bash
  eas build --platform ios --profile production
  ```
  - [ ] 依赖安装完成
  - [ ] 构建开始时间: `___________________`
  - [ ] 预计完成时间: 30-60 分钟
  - [ ] 构建成功
  - [ ] Build ID: `___________________`

- [ ] **等待上传到 App Store Connect**
  - [ ] 自动上传成功
  - [ ] 在 App Store Connect → TestFlight 中可见
  - [ ] 构建版本: `___________________`
  - [ ] 等待处理（10-30 分钟）

---

## Phase 4: TestFlight 测试

### 内部测试

- [ ] **配置内部测试**
  - [ ] App Store Connect → TestFlight → 内部测试
  - [ ] 添加内部测试人员（团队成员）
  - [ ] 启用"自动分发给测试人员"
  - [ ] 测试人员数量: ____ 人

- [ ] **开始内部测试**
  - [ ] 测试人员收到邮件邀请
  - [ ] 测试人员安装 TestFlight
  - [ ] 测试人员下载应用
  - [ ] 开始测试
  - [ ] 测试开始时间: `___________________`
  - [ ] 计划测试时长: ____ 天

- [ ] **内部测试验证**
  - [ ] 用户注册/登录功能
  - [ ] 添加宝宝信息
  - [ ] 喂养记录功能
  - [ ] 睡眠记录功能
  - [ ] 换尿布记录功能
  - [ ] 成长数据记录
  - [ ] 数据同步功能
  - [ ] 图表显示正常
  - [ ] 通知功能正常
  - [ ] 无崩溃或严重 bug

- [ ] **收集内部反馈**
  - [ ] 创建反馈收集表格
  - [ ] 记录 bug 和改进建议
  - [ ] 优先级排序
  - [ ] Bug 数量: ____ 个（关键 ____ | 一般 ____ | 轻微 ____）

- [ ] **修复问题并发布更新**
  ```bash
  # 更新版本号
  # 重新构建
  ./deploy-ios.sh production
  ```
  - [ ] 所有关键 bug 已修复
  - [ ] 新版本已发布到 TestFlight
  - [ ] 更新版本号: `___________________`

### 外部测试（可选但推荐）

- [ ] **配置外部测试**
  - [ ] 创建测试群组
  - [ ] 群组名称: `___________________`
  - [ ] 添加测试说明
  - [ ] 填写测试信息
  - [ ] 填写反馈邮箱
  - [ ] 填写营销 URL
  - [ ] 填写隐私政策 URL

- [ ] **提交外部测试审核**
  - [ ] 提交审核（Apple 审核）
  - [ ] 提交时间: `___________________`
  - [ ] 等待审核（通常 24-48 小时）
  - [ ] 审核通过时间: `___________________`

- [ ] **生成邀请链接**
  - [ ] 启用公开链接
  - [ ] 设置测试人员上限: ____ 人
  - [ ] 邀请链接: `___________________`

- [ ] **分发测试**
  - [ ] 通过邮件分享链接
  - [ ] 在社交媒体分享
  - [ ] 在官网发布
  - [ ] 目标测试人数: ____ 人
  - [ ] 实际测试人数: ____ 人

- [ ] **外部测试期间**
  - [ ] 测试开始时间: `___________________`
  - [ ] 计划测试时长: 2-3 周
  - [ ] 每日监控：
    - [ ] 新安装数
    - [ ] 崩溃报告
    - [ ] 用户反馈
  - [ ] 记录问题和改进建议

- [ ] **测试总结**
  - [ ] 总测试人数: ____ 人
  - [ ] 活跃测试人数: ____ 人
  - [ ] 发现 bug 数: ____ 个
  - [ ] 用户满意度: ____/10
  - [ ] 主要问题已解决
  - [ ] 准备正式发布

---

## Phase 5: App Store 发布

### 准备发布资料

- [ ] **上传截图**
  - [ ] 6.7" Display: ____ 张
  - [ ] 6.5" Display: ____ 张
  - [ ] 5.5" Display: ____ 张
  - [ ] 截图按顺序排列
  - [ ] 截图质量检查

- [ ] **上传 App 图标**
  - [ ] 1024x1024 PNG
  - [ ] 无圆角
  - [ ] 无透明通道
  - [ ] 图标已上传

- [ ] **上传 App 预览视频**（可选）
  - [ ] 视频时长 15-30 秒
  - [ ] 视频质量检查
  - [ ] 视频已上传

- [ ] **填写文案**
  - [ ] App 名称: `___________________`
  - [ ] 副标题: `___________________`
  - [ ] 描述（最多 4000 字符）
  - [ ] 关键词（最多 100 字符，逗号分隔）
  - [ ] 促销文本（可选，最多 170 字符）
  - [ ] 支持 URL
  - [ ] 营销 URL（可选）

### 提交审核

- [ ] **选择构建版本**
  - [ ] App Store Connect → App Store → "+" 新版本
  - [ ] 版本号: `___________________`
  - [ ] 选择 TestFlight 构建: `___________________`

- [ ] **填写版本信息**
  - [ ] "此版本的新增内容"（版本说明）
  - [ ] 示例：
    ```
    🎉 BabyBeats 正式发布！

    • 全面的宝宝日常记录功能
    • 科学的成长数据追踪
    • 智能喂养和睡眠计时器
    • 美观直观的数据可视化
    • 多设备数据同步

    感谢您选择 BabyBeats！
    ```

- [ ] **审核信息**
  - [ ] 联系人姓名: `___________________`
  - [ ] 联系人电话: `___________________`
  - [ ] 联系人邮箱: `___________________`
  - [ ] 登录所需: ☑ 是 ☐ 否
  - [ ] 测试账号:
    - 用户名: `___________________`
    - 密码: `___________________`
    - 说明: `___________________`
  - [ ] 审核备注（如有特殊说明）

- [ ] **版权和贸易**
  - [ ] 导出合规信息: ☑ 是 ☐ 否
  - [ ] 内容版权: `___________________`
  - [ ] 广告标识符: ☐ 是 ☑ 否

- [ ] **最终检查**
  - [ ] 所有必填信息已完成
  - [ ] 所有资料已上传
  - [ ] 隐私政策可访问
  - [ ] 支持 URL 可访问
  - [ ] 测试账号可用
  - [ ] 无明显错别字

- [ ] **提交审核**
  - [ ] 点击"提交以供审核"
  - [ ] 提交时间: `___________________`
  - [ ] 状态: 正在等待审核

### 审核过程

- [ ] **监控审核状态**
  - [ ] 每天检查审核状态
  - [ ] 及时查看 Resolution Center 消息
  - [ ] 审核状态记录：
    - [ ] 正在等待审核 (开始: `___________`)
    - [ ] 正在审核中 (开始: `___________`)
    - [ ] 等待发布 / 被拒绝 (时间: `___________`)

- [ ] **如果被拒绝**
  - [ ] 阅读拒绝原因: `___________________`
  - [ ] 在 Resolution Center 回复
  - [ ] 修复问题
  - [ ] 重新提交（如需要新构建）
  - [ ] 重新提交时间: `___________________`

- [ ] **审核通过**
  - [ ] 收到审核通过邮件
  - [ ] 审核通过时间: `___________________`
  - [ ] 状态: 等待开发者发布

### 正式发布

- [ ] **选择发布方式**
  - [ ] ☐ 自动发布（审核通过后立即上架）
  - [ ] ☑ 手动发布（选择发布时间）

- [ ] **手动发布步骤**
  - [ ] App Store Connect → 版本发布
  - [ ] 点击"发布此版本"
  - [ ] 发布时间: `___________________`

- [ ] **验证发布**
  - [ ] 24 小时后在 App Store 搜索应用
  - [ ] 应用可见时间: `___________________`
  - [ ] 测试下载和安装
  - [ ] 在不同地区验证可见性

---

## Phase 6: 发布后运营

### 监控和维护

- [ ] **监控指标**
  - [ ] 下载量（每日/每周）
  - [ ] 活跃用户数
  - [ ] 用户评分和评价
  - [ ] 崩溃率
  - [ ] API 请求量
  - [ ] 服务器负载

- [ ] **收集反馈**
  - [ ] 查看 App Store 评价
  - [ ] 查看邮件反馈
  - [ ] 监控社交媒体提及
  - [ ] 创建用户反馈渠道

- [ ] **Bug 修复**
  - [ ] 监控崩溃报告
  - [ ] 优先修复高频 bug
  - [ ] 记录已知问题
  - [ ] 规划修复版本

### 后续版本更新

- [ ] **规划更新内容**
  - [ ] 根据用户反馈
  - [ ] 添加新功能
  - [ ] 性能优化
  - [ ] UI/UX 改进

- [ ] **发布更新版本**
  - [ ] 更新版本号: `___________________`
  - [ ] 构建新版本
  - [ ] TestFlight 测试
  - [ ] 提交审核
  - [ ] 发布

- [ ] **更新频率**
  - [ ] 计划更新频率: 每 ____ 周/月
  - [ ] 下次更新计划时间: `___________________`

### 运营推广（可选）

- [ ] **ASO 优化**
  - [ ] 优化关键词
  - [ ] 更新截图和描述
  - [ ] 鼓励用户评价
  - [ ] 监控排名变化

- [ ] **推广渠道**
  - [ ] 社交媒体
  - [ ] 育儿社区
  - [ ] 母婴平台
  - [ ] 付费广告（可选）

---

## 紧急联系信息

### 重要账号信息（请妥善保管）

```
Apple Developer:
  - Apple ID: ___________________
  - Team ID: ___________________
  - 密码提示: ___________________

Expo:
  - 账号: ___________________
  - 密码提示: ___________________

服务器:
  - IP: ___________________
  - SSH 用户: ___________________
  - SSH 密钥路径: ___________________

域名:
  - 域名: ___________________
  - 注册商: ___________________
  - 管理后台: ___________________

数据库:
  - DB User: ___________________
  - DB Password: ___________________（加密保存）

其他重要信息:
  - ___________________
  - ___________________
```

### 技术支持

- **文档**:
  - iOS 发布指南: `IOS_DEPLOYMENT_GUIDE.md`
  - 后端部署指南: `BACKEND_DEPLOYMENT_GUIDE.md`
  - 部署总览: `DEPLOYMENT_OVERVIEW.md`

- **社区支持**:
  - Expo Forum: https://forums.expo.dev
  - Apple Developer Forum: https://developer.apple.com/forums
  - Stack Overflow: https://stackoverflow.com

---

## 完成确认

- [ ] 所有检查项已完成
- [ ] 应用成功上架 App Store
- [ ] 后端服务稳定运行
- [ ] 监控和备份已配置
- [ ] 文档已归档保存

**发布完成日期**: `___________________`

**发布人签名**: `___________________`

---

*祝发布顺利！* 🎉

*最后更新: 2025-11-17*

